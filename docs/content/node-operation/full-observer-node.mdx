---
title: Observer Node
sidebar_title: Observer Node
description: Running an observer node locally
---


An observer node is similar to an access node and provides a locally accessible, continuously updated and verified copy of the block data.
It can be easily run on any consumer-grade computer which has enough disk space.

## Running a node

### Step 1 Generate the node directory structure
The observer node requires the following directory structure,
```
$ tree flow_observer/
flow_observer/
├── bootstrap
│         ├── network.key (file containing the node private network key)
│         └── public-root-information
│             └── root-protocol-state-snapshot.json (the genesis data of the current spork)
└── data (directory used by the observer node to store block data)
```

Create the parent and the sub-directories
e.g.
```
mkdir flow_observer
mkdir flow_observer/bootstrap
mkdir flow_observer/bootstrap/public-root-information
mkdir flow_observer/data
```

### Step 2 Generate the network key

Like any other Flow node, the observer also needs a networking ECDSA key to talk to the network.
The [Flow cli](https://developers.flow.com/tools/flow-cli/install) can be used to generate this key.

e.g.
```
flow keys generate
Private Key  1fc3d962ec947bcc9d8dfae6b1e2b54dbdd208bbca0c7af094d5d52c7991257f
Public Key   774e3812f031d57f767a0afa79bd2cfad8a99b3d20b039f6583f82a5dbc5a208be70aa616ddfa1c7676ccac0b4e4e7da78ebdac6ab0d47cbae1efec95f66a7a5
```

Store the private key in a file under the bootstrap subdirectory
e.g.
```
$ cat flow_observer/bootstrap/network.key
1fc3d962ec947bcc9d8dfae6b1e2b54dbdd208bbca0c7af094d5d52c7991257f
```

### Step 3 Download the root-protocol-state-snapshot.json file for the current spork

The `root-protocol-state-snapshot.json` is generated for each [spork](https://developers.flow.com/nodes/node-operation/spork) and contains the genesis data for that spork.
It is published and made available after each spork. The download location is specified [here](https://github.com/onflow/flow/blob/master/sporks.json) under [rootProtocolStateSnapshot](https://github.com/onflow/flow/blob/master/sporks.json#L16) and can be downloaded as follows,

For mainnet-18
```
wget -P bootstrap/public-root-information https://storage.googleapis.com/flow-genesis-bootstrap/mainnet-18-execution/public-root-information/root-protocol-state-snapshot.json
wget -P bootstrap/public-root-information https://storage.googleapis.com/flow-genesis-bootstrap/mainnet-18-execution/public-root-information/root-protocol-state-snapshot.json.asc
```

For testnet-37
```
wget -P bootstrap/public-root-information https://storage.googleapis.com/flow-genesis-bootstrap/testnet-37/public-root-information/root-protocol-state-snapshot.json
wget -P bootstrap/public-root-information https://storage.googleapis.com/flow-genesis-bootstrap/testnet-37/public-root-information/root-protocol-state-snapshot.json.asc
```

#### Verify the PGP signature

Add the `flow-signer@onflow.org` public key
```
gpg --keyserver keys.openpgp.org --search-keys flow-signer@onflow.org
```

Verify the root-snapshot file
```
gpg --verify bootstrap/public-root-information/root-protocol-state-snapshot.json.asc
```

```
gpg: assuming signed data in 'bootstrap/public-root-information/root-protocol-state-snapshot.json'
gpg: Signature made Wed Sep 15 11:34:33 2021 PDT
gpg:                using ECDSA key 40CD95717AC463E61EE3B285B718CA310EDB542F
gpg: Good signature from "Flow Team (Flow Full Observer node snapshot verification master key) <flow-signer@onflow.org>" [unknown]
gpg: WARNING: This key is not certified with a trusted signature!
gpg:          There is no indication that the signature belongs to the owner.
Primary key fingerprint: 7D23 8D1A E6D3 2A71 8ECD  8611 CB52 64F7 FD4C DD27
     Subkey fingerprint: 40CD 9571 7AC4 63E6 1EE3  B285 B718 CA31 0EDB 542F
```

### Step 4 Start the node

The observer node can be run as a docker container

#### Observer for Flow Mainnet

```
docker run --rm \
 -v /var/flow/bootstrap:/bootstrap:ro  \
 -v /var/flow/data:/data:rw \
 --name flow_observer \
 --network host  \
 gcr.io/flow-container-registry/observer:v0.27.1 \
 --bootstrapdir=/bootstrap \
 --datadir=/data/protocol \
 --bind 0.0.0.0:3569  \
 --loglevel=info \
 --secretsdir=/data/secrets  \
 --upstream-node-addresses=access-008.mainnet18.nodes.onflow.org:9001 \
 --upstream-node-public-keys=11742552d21ac93da37ccda09661792977e2ca548a3b26d05f22a51ae1d99b9b75c8a9b3b40b38206b38951e98e4d145f0010f8942fd82ddf0fb1d670202264a \
 --bootstrap-node-addresses=access-008.mainnet18.nodes.onflow.org:3570  \
 --bootstrap-node-public-keys=11742552d21ac93da37ccda09661792977e2ca548a3b26d05f22a51ae1d99b9b75c8a9b3b40b38206b38951e98e4d145f0010f8942fd82ddf0fb1d670202264a \
 --observer-networking-key-path=/bootstrap/network.key
```

#### Observer for Flow Testnet

```
docker run --rm \
 -v /var/flow/bootstrap:/bootstrap:ro  \
 -v /var/flow/data:/data:rw \
 --name flow_observer \
 --network host  \
 --gcr.io/flow-container-registry/observer:v0.27.1 \
 --bootstrapdir=/bootstrap \
 --datadir=/data/protocol \
 --bind 0.0.0.0:3569  \
 --loglevel=info \
 --secretsdir=/data/secrets  \
 --upstream-node-addresses=access-003.devnet37.nodes.onflow.org:9001 \
 --upstream-node-public-keys=b662102f4184fc1caeb2933cf87bba75cdd37758926584c0ce8a90549bb12ee0f9115111bbbb6acc2b889461208533369a91e8321eaf6bcb871a788ddd6bfbf7 \
 --bootstrap-node-addresses=access-003.devnet37.nodes.onflow.org:3570  \
 --bootstrap-node-public-keys=b662102f4184fc1caeb2933cf87bba75cdd37758926584c0ce8a90549bb12ee0f9115111bbbb6acc2b889461208533369a91e8321eaf6bcb871a788ddd6bfbf7 \
 --observer-networking-key-path=/bootstrap/network.key
```

_if running on mac, replace `--network host` with `-p 9000:9000`_

The observer node acts as a DHT client and bootstraps from upstream access nodes which run the DHT server.
The upstream bootstrap server is specified using the `bootstrap-node-addresses` which is the comma separated list of hostnames of the access nodes.
The `bootstrap-node-public-keys` are the corresponding networking public key of those nodes.

The observer node delegates many of the API calls to the upstream access nodes.
The `upstream-node-addresses` is the list of access node hostnames to which this observer node can delegate to. The list can be different from the boostrap node list.
The `bootstrap-node-public-key` are the corresponding networking public key of those nodes.

_In the above docker commands, the Flow community access nodes are being used as the upstream access nodes.
However, any other Flow access node that supports an observer node can be used_

#### Flow community access nodes that support connections from observer nodes

Note: while the public keys remain the same, the hostnames change each spork to include the spork name. Substitute `[devnet_spork]` and `[mainnet_spork]` with the appropriate spork name (e.g. `mainnet14`). See [Past Sporks](https://docs.onflow.org/node-operation/past-sporks/) for the current spork for each network.

##### For mainnet

Access-007:
* Host: `access-007.[mainnet_spork].nodes.onflow.org`
* Public Key: `28a0d9edd0de3f15866dfe4aea1560c4504fe313fc6ca3f63a63e4f98d0e295144692a58ebe7f7894349198613f65b2d960abf99ec2625e247b1c78ba5bf2eae`

Access-008:
* Host: `access-008.[mainnet_spork].nodes.onflow.org`
* Public Key: `11742552d21ac93da37ccda09661792977e2ca548a3b26d05f22a51ae1d99b9b75c8a9b3b40b38206b38951e98e4d145f0010f8942fd82ddf0fb1d670202264a`

##### For testnet

Access-003:
* Host: `access-003.[devnet_spork].nodes.onflow.org`
* Public Key: `b662102f4184fc1caeb2933cf87bba75cdd37758926584c0ce8a90549bb12ee0f9115111bbbb6acc2b889461208533369a91e8321eaf6bcb871a788ddd6bfbf7`

Access-004:
* Host: `access-004.[devnet_spork].nodes.onflow.org`
* Public Key: `0d1523612be854638b985fc658740fa55f009f3cd49b739961ab082dc91b178ed781ef5f66878613b4d34672039150abfd9c8cfdfe48c565bca053fa4db30bec`


By default, the Observer node will serve the gRPC API on port 9000. To change this port use the parameter, `--rpc-addr` e.g. `--rpc-addr 9005`
Other parameters can be found [here](https://github.com/onflow/flow-go/blob/82da35141ff095fbf75ce2c950efec240ad38565/cmd/access/node_builder/access_node_builder.go#L523)


The node should now be up and running :rocket:

You can use the [flow cli](https://developers.flow.com/tools/flow-cli), to query the node for blocks, transaction etc. similar to an access node.

e.g.
```
flow blocks get latest --host localhost:9000
```