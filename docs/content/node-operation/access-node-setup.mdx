---
title: Setting Up a Flow Access Node
sidebar_title: Access Node Setup
description: How to run a permissionless Access node
---

This guide is for running a permissonless Access node on Flow. If you are planning to run a different type of staked node then see [node bootstrap](node-bootstrap.mdx).
Permissionless Access node allow any operator to run a Flow Access node.
Unlike the other staked nodes, a permissionless access node does not have to be approved by the service account before it can join the network, hence the term "permissionless". The goal is to make all node type permissionless and this is the first step towards achieving that goal.

## Who should run a Permissionless Access node?
dApp developers can choose to run their own private permissionless access node and move away from using the community access nodes. This will also allow them to be not subjected to the API rate limits of the shared access nodes.
Node operators can also run their own permissionless access node and provide access to that node as a service.
Chain analytics, audit and exploration applications can run such an access node and do not have to rely on third parties for the state of the network.

## Limitations
This is a preliminary implementation of full permissionless node operation.
Full functionality requires staking auctions to be implemented, which is still an upgrade planned for the future.
Hence, for this initial phase, exactly **five** slots in total will be opened for access nodes. If there are more than five staked access nodes at the end of the staking phase on 14th Feb 2023, five of those will be selected by an on-chain random selection process and no other permissionless ANs can join until others unstake.
More slots will be opened in the future if this goes well.
## How to run a Permissionless Access node?

<Callout type="info">
To run an access node you will need to provision a machine or virtual machine to run your node software. Please see follow the [node-provisioning](node-provisioning.mdx) guide for it.
You can provision the machine before or after your node has been chosen.
</Callout>

At a high level, to run a permissionless Access node, you will have to do the following steps:
1. Generate the node identity (private and public keys, node ID etc.).
2. Stake the node with 100 FLOW by ** EOD Tuesday, 14th February 2023 Pacific time (02/14/2023 12:00 PM Pacific or 02/15/2023 8:00 AM UTC) ** by providing the node information generated in step 1.
3. You can verify if your node ID was selected by the on-chain random selection process on the following Wednesday (15th February 2023) (see below).
4. If your node ID was selected, you can provision and start running the node. If your node wasn't selected, your tokens will have been refunded to your unstaked bucket in the staking smart contract. When the next epoch begins, you can try committing tokens again in a future epoch to get a new spot.

The following guidance outlines the process to register a staking request for your node during a staking auction, then check whether it was selected:

## Step  1 - Generate node information

<Callout type="info">
    You will need to run this step for each access node that you would like to run.
</Callout>

### Download the Bootstrapping Kit

<Callout type="warning">
    If you have downloaded the bootstrapping kit previously, ensure you check the hash below still matches. If not, re-download to ensure you are using the most up-to-date version.
</Callout>

```shell
curl -sL -O storage.googleapis.com/flow-genesis-bootstrap/boot-tools.tar
tar -xvf boot-tools.tar
```

```shell:title=CheckSHA256
sha256sum ./boot-tools/bootstrap
0d2cb2d0edb659880ae729e9d849a98535414af33690dad545d9892268167bcf  ./boot-tools/bootstrap
```

### Generate Your Node Identity

#### Network Address

<Callout type="info">

    Use a fully qualified domain name for the network address. Please also include the port number in the network address e.g. `flowaccess.mycompany.com:3569`

</Callout>

<Callout type="warning">

    Do not include in `http://` format.

</Callout>

<Callout type="info">

    If you would like to run multiple access nodes, please ensure you use a different networking addresses for each node.

</Callout>

```shell
#########################################################
# Generate Keys
$ mkdir ./bootstrap
# YOUR_NODE_ADDRESS: FQDN associated to your instance
$ ./boot-tools/bootstrap key --address "<YOUR_NODE_ADDRESS_GOES_HERE>:3569" --role access -o ./bootstrap
```

```shell:title=Example
$./boot-tools/bootstrap key --address "flowaccess.mycompany.com:3569" --role access  -o ./bootstrap
<nil> DBG will generate networking key
<nil> INF generated networking key
<nil> DBG will generate staking key
<nil> INF generated staking key
<nil> DBG will generate db encryption key
<nil> INF generated db encryption key
<nil> DBG assembling node information address=flowaccess.mycompany.com:3569
<nil> DBG encoded public staking and network keys networkPubKey=f493a74704f6961ae7903e062ecd58d990672858eff99aece7bfbccf3aa02de8f1a624ecbf21a01e8b2f4a5854c231fbe218edd7762a34fea881f3958a215305 stakingPubKey=ae8dcf81f3a70d72036b7ba2c586ed37ed0eb82b9c0a4aab998a8420f98894f94c14f84fa716e93654d3940fc0c8ff4d19b504c90a5b4918b28f421e9d3659dc2b7e246025ebeffea0d83cceefe315d7ed346dbe412fdac51b64997d97d29f7e
<nil> INF wrote file bootstrap/public-root-information/node-id
<nil> INF wrote file bootstrap/private-root-information/private-node-info_e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5/node-info.priv.json
<nil> INF wrote file bootstrap/private-root-information/private-node-info_e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5/secretsdb-key
<nil> INF wrote file bootstrap/public-root-information/node-info.pub.e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5.json

$tree ./bootstrap/
./bootstrap/
├── private-root-information
│        └── private-node-info_e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5
│        ├── node-info.priv.json
│        └── secretsdb-key
└── public-root-information
    ├── node-id
    └── node-info.pub.e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5.json

3 directories, 4 files
```

Your node identity has now been generated. Your <b>node ID</b> can be found in the file `./bootstrap/public-root-information/node-id`.

```shell:title=Example
$cat ./bootstrap/public-root-information/node-id
e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5
```

<Callout type="warning">
    All your private keys should be in the `bootstrap` folder created earlier. Please take a back up of the entire folder.
</Callout>


## Step  2 - Stake the node

You need to now register the node on chain by staking the node via [Flow Port](https://port.onflow.org/). [Here](https://developers.flow.com/nodes/flow-port) is a guide on how to use Flow port if you are not familiar with it.
If you are staking via a custody provider or would like to directly submit a staking transaction instead follow this [guide](/nodes/staking#how-do-i-stake).


The `node details` (`Node ID`, `Network Address`, `Networking Key` and `Staking Key`) that need to be submitted when staking the node on Flow Port, can be found in the file: `./bootstrap/public-root-information/node-info.pub.<node-id>.json`.

```shell:title=Example
$cat ./bootstrap/public-root-information/node-info.pub. e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5.json
{
  "Role": "access",
  "Address": "flowaccess.mycompany.com:3569",
  "NodeID": "e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5",
  "Weight": 1000,
  "NetworkPubKey": "f493a74704f6961ae7903e062ecd58d990672858eff99aece7bfbccf3aa02de8f1a624ecbf21a01e8b2f4a5854c231fbe218edd7762a34fea881f3958a215305",
  "StakingPubKey": "ae8dcf81f3a70d72036b7ba2c586ed37ed0eb82b9c0a4aab998a8420f98894f94c14f84fa716e93654d3940fc0c8ff4d19b504c90a5b4918b28f421e9d3659dc2b7e246025ebeffea0d83cceefe315d7ed346dbe412fdac51b64997d97d29f7e"
}
```

### Timing

New nodes are able to join the network each time a new epoch begins.
An epoch is a period of time (approximately one week) when the node operators in the network are constant.
At epoch boundaries, newly staked node operators are able to join the network and existing node operators which have unstaked may exit the network.
You can read more about epochs [here](https://developers.flow.com/nodes/staking/schedule).


In order to join the network at epoch N+1, the node **must** be registered with at least 100 FLOW staked prior to the end of epoch N's Staking Auction Phase.
Currently, an epoch transition on mainnet starts on Wednesday early morning. Hence, the node should be staked by EOD Tuesday to be able to join the network starting on Wednesday.

Confirmation of a new node's inclusion in epoch N+1 is included in the [`EpochSetup` event](/staking/epoch-scripts-events/#epochsetup).

![Flow Epoch Schedule](https://storage.googleapis.com/flow-resources/documentation-assets/epoch-startup-order.png)


## Step 3 - Verify if your node ID was selected

How to check? What scripts to run?

## Step 4 - Start your node

If your node has gotten selected as part of Step 3, you can now start your node.
First you'll need to provision a machine or virtual machine to run your node software. Please see follow the [node-provisioning](node-provisioning.mdx) guide for it.

## Pull the Flow Images

The `flow-go` binaries are distributed as container images, and need to be pulled down to your host with your image management tool of choice.

Replace `$ROLE` with the node type you are planning to run. Valid options are:

- collection
- consensus
- execution
- verification
- access

```shell
  # Docker
  docker pull gcr.io/flow-container-registry/${ROLE}:alpha-v0.0.1

  # Containerd
  ctr images pull gcr.io/flow-container-registry/${ROLE}:alpha-v0.0.1",
```

## Prepare Your Node to Start

Your nodes will need to boot at startup, and restart if they crash.

If you are running `systemd` you can use the service files provided by `flow-go`.
Find them in the [Flow Go](https://github.com/onflow/flow-go/tree/master/deploy).

If you are using some other system besides Systemd, you need to ensure that the Flow container is started,
the appropriate key directories are mounted into the container, and that the container will
automatically restart following a crash.

The `systemd` files pull runtime settings from `/etc/flow/runtime-config.env` and any `.env`
files under `/etc/flow/conf.d`. Examples of these files are also available in the github repo.
You will need to modify the runtime config file later.

### Systemd

<Callout type="info">
    If you are not using Systemd, you can skip this step
</Callout>

1. Ensure that you pulled the latest changes from [flow-go repository](https://github.com/onflow/flow-go) via `git`

```shell
## Clone the repo if you haven't already done so
git clone https://github.com/onflow/flow-go

## Get latest changes
cd flow-go
git pull origin master
```

2. Copy your respective [systemd unit file](https://github.com/onflow/flow-go/tree/master/deploy/systemd-docker) to: `/etc/systemd/system`
3. Create directory `sudo mkdir /etc/flow`
4. Copy the [runtime-conf.env](https://github.com/onflow/flow-go/blob/master/deploy/systemd-docker/runtime-conf.env) file to: `/etc/flow/`
5. Enable your service `sudo systemctl enable flow-$ROLE.service` (replace `$ROLE` with your node role - eg. `collection`)

### Docker Configuration

If you are not using Systemd, sample commands for running each Docker container are below.
Be sure to replace `/path/to/data` and `/path/to/bootstrap` with the appropriate paths you are using.

<Callout type="warning">
    Do not run your node using `docker run` command directly without a mechanism for the node
    to automatically restart following a crash.
</Callout>

<Callout type="info">
    The actual Docker image tag can be found [here](https://developers.flow.com/nodes/node-operation/past-sporks) for appropriate spork.
</Callout>


```shell
docker run --rm \
	-v /path/to/bootstrap:/bootstrap:ro \
	-v /path/to/data:/data:rw \
	--name flow-go \
	--network host \
	gcr.io/flow-container-registry/access:<applicable docker tag> \
	--nodeid=${FLOW_GO_NODE_ID} \
	--bootstrapdir=/bootstrap \
	--datadir=/data/protocol \
	--secretsdir=/data/secrets \
	--rpc-addr=0.0.0.0:9000 \
	--http-addr=0.0.0.0:8000 \
	--collection-ingress-port=9000 \
	--script-addr=${FLOW_NETWORK_EXECUTION_NODE} \
	--bind 0.0.0.0:3569 \
	--loglevel=error
```

### Start the Node

Now that your node is provisioned and configured, it can be started.

<Callout type="warning">

    Before starting your node, ensure it is [registered](node-bootstrap#step-2---stake-your-node) and [authorized](node-bootstrap#confirming-authorization).

</Callout>

Ensure you start your node at the appropriate time.
See [Spork Process](spork) for when to start up a node following a spork.
See [Node Bootstrap](node-bootstrap#timing) for when to start up a newly registered node.

### Systemd

1. Check that your `runtime-conf.env` is at `/etc/flow/runtime-conf.env`
2. Update your environment variables: `source /etc/flow/runtime-conf.env`
3. Start your service: `sudo systemctl start flow`

## Verify your Node is Running


Here are a few handy commands that you can use to check if your Flow node is up and running

### Systemd

- To get Flow logs: `sudo journalctl -u flow-YOUR_ROLE`
- To get the status: `sudo systemctl status flow`

```shell
● flow-verification.service - Flow Access Node running with Docker
Loaded: loaded (/etc/systemd/system/flow-verification.service; enabled; vendor preset: enabled)
Active: active (running) since Wed 2020-05-20 18:18:13 UTC; 1 day 6h ago
Process: 3207 ExecStartPre=/usr/bin/docker pull gcr.io/flow-container-registry/verification:${FLOW_GO_NODE_VERSION} (code=exited, status=0/SUCCESS)
Main PID: 3228 (docker)
Tasks: 10 (limit: 4915)
Memory: 33.0M
CGroup: /system.slice/flow-verification.service
        └─3228 /usr/bin/docker run --rm -v /var/flow/bootstrap:/bootstrap:ro -v /var/flow/data:/data:rw --rm --name flow-go --network host gcr.io/flow-container-registry/verification:candidate8 --nodeid=489f8a4513d5bd8b8b093108fec00327b683db545b37b4ea9153f61b2c0c49dc --bootstrapdir=/bootstrap --datadir=/data/protocol --alpha=1 --bind 0.0.0.0:3569 --loglevel=error
```

### Docker

- To get Flow logs: `sudo docker logs flow-go`
- To get the status: `sudo docker ps`

```shell
$ sudo docker ps
CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
1dc5d43385b6 gcr.io/flow-container-registry/verification:candidate8 \"/bin/app --nodeid=4…\" 30 hours ago Up 30 hours flow-go
```



## Monitoring and Metrics

The node publishes several Prometheus metrics. See [Monitoring Node Health](monitoring-nodes) to setup node monitoring.

### Node Status

The metrics for the node should be able to provide a good overview of the status of the node. If we want to get a quick snapshot of the status of the node, and if it's properly participating in the network, you can check the `consensus_compliance_finalized_height` or `consensus_compliance_sealed_height` metric, and ensure that it is not zero and strictly increasing.

```shell
curl localhost:8080/metrics | grep consensus_compliance_sealed_height

# HELP consensus_compliance_sealed_height the last sealed height
# TYPE consensus_compliance_sealed_height gauge
consensus_compliance_sealed_height 1.132054e+06
```
