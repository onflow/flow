---
title: Setting Up a Flow Access Node
sidebar_title: Access Node Setup
description: How to run a permissionless Access node
---

This guide is for running a permissonless Access node on Flow. If you are planning to run a different type of staked node then see [node bootstrap](node-bootstrap.mdx).
Permissionless Access nodes allow any operator to run a Flow Access node.
Unlike the other staked nodes, a permissionless access node does not have to be approved by the service account before it can join the network, hence the term "permissionless". The goal is to make all node type permissionless and this is the first step towards achieving that goal.

## Who should run a Permissionless Access node?
dApp developers can choose to run their own private permissionless access node and move away from using the community access nodes. This will also allow them to be not subjected to the API rate limits of the shared access nodes.
Node operators can also run their own permissionless access node and provide access to that node as a service.
Chain analytics, audit and exploration applications can run such an access node and do not have to rely on third parties for the state of the network.

## Limitations
This is a preliminary implementation of full permissionless node operation and there will be exactly **five** slots in total that will be opened for access nodes.
If there are more than five staked access nodes at the end of the staking phase on 14th Feb 2023 EOD PT, five of those will be selected by an on-chain random selection process and no other permissionless ANs can join until others unstake in the next epoch.
More slots will be opened in the future if this goes well.
Support for unlimited access nodes requires staking auctions to be implemented, which is still an upgrade planned for the future.

## How to run a Permissionless Access node?

<Callout type="info">
To run an access node you will need to provision a machine or virtual machine to run your node software. Please follow the [node-provisioning](node-provisioning.mdx) guide for it.
You can provision the machine before or after your node has been chosen.
</Callout>

At a high level, to run a permissionless Access node, you will have to do the following steps:
1. Generate the node identity (private and public keys, node ID etc.).
2. Stake the node with 100 FLOW by ** EOD Tuesday, 14th February 2023 Pacific time (02/14/2023 12:00 PM Pacific or 02/15/2023 8:00 AM UTC) ** by providing the node information generated in step 1.
3. You can verify if your node ID was selected by the on-chain random selection process on the following Wednesday (15th February 2023) (see below).
4. If your node ID was selected, you can provision and start running the node. If your node wasn't selected, your tokens will have been refunded to your unstaked bucket in the staking smart contract. When the next epoch begins, you can try committing tokens again in a future epoch to get a new spot.

The following guidance outlines the process to register a staking request for your node during a staking auction, then check whether it was selected:

## Step  1 - Generate node information

<Callout type="info">
    You will need to run this step for each access node that you would like to run.
</Callout>

### Download the Bootstrapping Kit

<Callout type="warning">
    If you have downloaded the bootstrapping kit previously, ensure you check the hash below still matches. If not, re-download to ensure you are using the most up-to-date version.
</Callout>

```shell
curl -sL -O storage.googleapis.com/flow-genesis-bootstrap/boot-tools.tar
tar -xvf boot-tools.tar
```

```shell:title=CheckSHA256
sha256sum ./boot-tools/bootstrap
0d2cb2d0edb659880ae729e9d849a98535414af33690dad545d9892268167bcf  ./boot-tools/bootstrap
```

### Generate Your Node Identity

#### Network Address

<Callout type="info">

    Use a fully qualified domain name for the network address. Please also include the port number in the network address e.g. `flowaccess.mycompany.com:3569`

</Callout>

<Callout type="warning">

    Do not include in `http://` format.

</Callout>

<Callout type="info">

    If you would like to run multiple access nodes, please ensure you use a different networking addresses for each node.

</Callout>

```shell
#########################################################
# Generate Keys
$ mkdir ./bootstrap
# YOUR_NODE_ADDRESS: FQDN associated to your instance
$ ./boot-tools/bootstrap key --address "<YOUR_NODE_ADDRESS_GOES_HERE>:3569" --role access -o ./bootstrap
```

```shell:title=Example
$./boot-tools/bootstrap key --address "flowaccess.mycompany.com:3569" --role access  -o ./bootstrap
<nil> DBG will generate networking key
<nil> INF generated networking key
<nil> DBG will generate staking key
<nil> INF generated staking key
<nil> DBG will generate db encryption key
<nil> INF generated db encryption key
<nil> DBG assembling node information address=flowaccess.mycompany.com:3569
<nil> DBG encoded public staking and network keys networkPubKey=f493a74704f6961ae7903e062ecd58d990672858eff99aece7bfbccf3aa02de8f1a624ecbf21a01e8b2f4a5854c231fbe218edd7762a34fea881f3958a215305 stakingPubKey=ae8dcf81f3a70d72036b7ba2c586ed37ed0eb82b9c0a4aab998a8420f98894f94c14f84fa716e93654d3940fc0c8ff4d19b504c90a5b4918b28f421e9d3659dc2b7e246025ebeffea0d83cceefe315d7ed346dbe412fdac51b64997d97d29f7e
<nil> INF wrote file bootstrap/public-root-information/node-id
<nil> INF wrote file bootstrap/private-root-information/private-node-info_e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5/node-info.priv.json
<nil> INF wrote file bootstrap/private-root-information/private-node-info_e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5/secretsdb-key
<nil> INF wrote file bootstrap/public-root-information/node-info.pub.e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5.json

$tree ./bootstrap/
./bootstrap/
├── private-root-information
│        └── private-node-info_e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5
│        ├── node-info.priv.json
│        └── secretsdb-key
└── public-root-information
    ├── node-id
    └── node-info.pub.e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5.json

3 directories, 4 files
```

Your node identity has now been generated. Your <b>node ID</b> can be found in the file `./bootstrap/public-root-information/node-id`.

```shell:title=Example
$cat ./bootstrap/public-root-information/node-id
e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5
```

<Callout type="warning">
    All your private keys should be in the `bootstrap` folder created earlier. Please take a back up of the entire folder.
</Callout>


## Step  2 - Stake the node

You need to now register the node on chain by staking the node via [Flow Port](https://port.onflow.org/). [Here](https://developers.flow.com/nodes/flow-port) is a guide on how to use Flow port if you are not familiar with it.
If you are staking via a custody provider or would like to directly submit a staking transaction instead follow this [guide](/nodes/staking#how-do-i-stake).


The `node details` (`Node ID`, `Network Address`, `Networking Key` and `Staking Key`) that need to be submitted when staking the node on Flow Port, can be found in the file: `./bootstrap/public-root-information/node-info.pub.<node-id>.json`.

```shell:title=Example
$cat ./bootstrap/public-root-information/node-info.pub. e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5.json
{
  "Role": "access",
  "Address": "flowaccess.mycompany.com:3569",
  "NodeID": "e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5",
  "Weight": 1000,
  "NetworkPubKey": "f493a74704f6961ae7903e062ecd58d990672858eff99aece7bfbccf3aa02de8f1a624ecbf21a01e8b2f4a5854c231fbe218edd7762a34fea881f3958a215305",
  "StakingPubKey": "ae8dcf81f3a70d72036b7ba2c586ed37ed0eb82b9c0a4aab998a8420f98894f94c14f84fa716e93654d3940fc0c8ff4d19b504c90a5b4918b28f421e9d3659dc2b7e246025ebeffea0d83cceefe315d7ed346dbe412fdac51b64997d97d29f7e"
}
```

### Timing

New nodes are able to join the network each time a new epoch begins.
An epoch is a period of time (approximately one week) when the node operators in the network are constant.
At epoch boundaries, newly staked node operators are able to join the network and existing node operators which have unstaked may exit the network.
You can read more about epochs [here](https://developers.flow.com/nodes/staking/schedule).


In order to join the network at epoch N+1, the node **must** be registered with at least 100 FLOW staked prior to the end of epoch N's Staking Auction Phase.
Currently, an epoch transition on mainnet starts on Wednesday (Pacific time) early morning. Hence, the node should be staked by EOD Tuesday (Pacific time) to be able to join the network starting on Wednesday.

Confirmation of a new node's inclusion in epoch N+1 is included in the [`EpochSetup` event](/staking/epoch-scripts-events/#epochsetup).

![Flow Epoch Schedule](https://storage.googleapis.com/flow-resources/documentation-assets/epoch-startup-order.png)


## Step 3 - Verify if your node ID was selected

There are two main ways to verify if your node was selected. If you can monitor events, look for [the epoch setup event](/staking/epoch-scripts-events/#epochsetup) that gets emitted by the epoch contract. That event is emitted at the end of epoch N's staking auction and contains a list of node IDs that are confirmed for the next epoch.

Another way to verify is the query the information directly. After the staking auction ends, you can use the [get node info script](/staking/epoch-scripts-events#get-all-of-the-info-associated-with-a-single-node-staker) to get the information about your node. If your tokens are shown in the `tokensCommitted` or `tokensStaked` balance, you are confirmed for the next epoch. If the tokens are in the `tokensUnstaked` balance, then your node was not chosen.

## Step 4 - Start your node

If your node has gotten selected as part of Step 3, you can now start your node.

First you'll need to provision a machine or virtual machine to run your node software. Please see follow the [node-provisioning](node-provisioning.mdx) guide for it.

The access node can be run as a docker container with the following command by replacing nodeid with your node ID.

```shell
docker run --rm \
  -v $PWD/flow_observer/bootstrap:/bootstrap:ro  \
  -v $PWD/flow_observer/data:/data:rw \
  --rm \
  --name flow-go \
  --network host \
  gcr.io/flow-container-registry/access:v0.29.7 \
  --nodeid=[Insert you NODE ID here] \
  --bootstrapdir=/bootstrap \
  --datadir=/data/protocol \
  --secretsdir=/data/secrets  \
  --rpc-addr=0.0.0.0:9099 \
  --http-addr=0.0.0.0:8088 \
  --rest-addr=0.0.0.0:8071 \
  --rpc-metrics-enabled=true \
  --bind 0.0.0.0:3569 \
  --dynamic-startup-access-address=secure.mainnet.nodes.onflow.org:9001 \
  --dynamic-startup-access-publickey=28a0d9edd0de3f15866dfe4aea1560c4504fe313fc6ca3f63a63e4f98d0e295144692a58ebe7f7894349198613f65b2d960abf99ec2625e247b1c78ba5bf2eae \
  --loglevel=error
```

Example, for the Node ID e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5, the docker command be the following,
```shell:title=Example
docker run --rm \
  -v $PWD/flow_observer/bootstrap:/bootstrap:ro  \
  -v $PWD/flow_observer/data:/data:rw \
  --rm \
  --name flow-go \
  --network host \
  gcr.io/flow-container-registry/access:v0.29.7 \
  --nodeid=e737ec6efbd26ef43bf676911cdc5a11ba15fc6562d05413e6589fccdd6c06d5 \
  --bootstrapdir=/bootstrap \
  --datadir=/data/protocol \
  --secretsdir=/data/secrets  \
  --rpc-addr=0.0.0.0:9099 \
  --http-addr=0.0.0.0:8088 \
  --rest-addr=0.0.0.0:8071 \
  --rpc-metrics-enabled=true \
  --bind 0.0.0.0:3569 \
  --dynamic-startup-access-address=secure.mainnet.nodes.onflow.org:9001 \
  --dynamic-startup-access-publickey=28a0d9edd0de3f15866dfe4aea1560c4504fe313fc6ca3f63a63e4f98d0e295144692a58ebe7f7894349198613f65b2d960abf99ec2625e247b1c78ba5bf2eae \
  --loglevel=error
````

For a more mature setup, it is recommended that you run the container using systemd as described [here](node-setup#systemd)

## Monitoring and Metrics

The node publishes several Prometheus metrics. See [Monitoring Node Health](monitoring-nodes) to setup node monitoring.

### Node Status

The metrics for the node should be able to provide a good overview of the status of the node. If we want to get a quick snapshot of the status of the node, and if it's properly participating in the network, you can check the `consensus_compliance_finalized_height` or `consensus_compliance_sealed_height` metric, and ensure that it is not zero and strictly increasing.

```shell
curl localhost:8080/metrics | grep consensus_compliance_sealed_height

# HELP consensus_compliance_sealed_height the last sealed height
# TYPE consensus_compliance_sealed_height gauge
consensus_compliance_sealed_height 1.132054e+06
```
